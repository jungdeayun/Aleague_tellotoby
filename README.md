# ë¯¸ë‹ˆë“œë¡  ììœ¨ì£¼í–‰ ê²½ì§„ëŒ€íšŒ Aë¦¬ê·¸ í…”ë¡œí† ë¹„íŒ€!ğŸš€
[![TelloToby](https://img.shields.io/badge/Tello-Toby-blue.svg)](https://github.com/jungdeayun/Aleague_tellotoby) 

![ë“œë¡ ê´€ì ì£¼í–‰](/readmeFile/drone.gif) 
<br></br>
## 1. ëŒ€íšŒ ì§„í–‰ ì „ëµ
![ì „ëµ](/readmeFile/ì „ëµ.png)
### ì €í¬ íŒ€ì˜ ì „ëµì€ ìƒí•˜ì¢Œìš°ì˜ í”½ì…€ ìˆ˜ë¥¼ ë¹„êµí•´ ì´ë™í•˜ì—¬ ì´ˆë¡ìƒ‰ ë§ì„ ì¸ì‹í•˜ê²Œ í•˜ì—¬ êµ¬ë©ì„ ì°¾ì€ ë’¤, ë“œë¡  ì˜ìƒ í¬ê¸°ì˜ ì¤‘ì‹¬ì ê³¼ ë“œë¡  ì˜ìƒì˜ ë§ êµ¬ë©ì˜ ì¤‘ì‹¬ì ì˜ ì°¨ì´ë¥¼ ê³„ì‚°í•˜ì—¬ í†µê³¼í•˜ë„ë¡ í•©ë‹ˆë‹¤. ë¹¨ê°„ìƒ‰ ì ê³¼ íŒŒë€ìƒ‰ ì ë„ ë˜‘ê°™ì´ í”½ì…€ ìˆ˜ë¥¼ ì´ìš©í•´ 90ë„ íšŒì „ ë˜ëŠ” ì°©ì§€í•˜ë„ë¡ í•©ë‹ˆë‹¤.

<br></br>
## 2. ì•Œê³ ë¦¬ì¦˜ ì„¤ëª…
![ì•Œê³ ë¦¬ì¦˜ë„](/readmeFile/ì•Œê³ ë¦¬ì¦˜.png)

 1. ë“œë¡  ì´ë¥™

- **ì´ë¯¸ì§€ ì „ì²˜ë¦¬**
 2. í…”ë¡œ ë“œë¡ ì˜ ì˜ìƒì„ ë°›ì•„ì™€ [Snapshot](https://kr.mathworks.com/help/supportpkg/ryzeio/ref/snapshot.html) í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ì‚¬ì§„ ì˜ìƒì„ ê°€ì ¸ì˜´
 3. RGB ìƒ‰ ê³µê°„ì—ì„œ HSV ìƒ‰ ê³µê°„ìœ¼ë¡œ ë³€ê²½í•¨
 4. ë§ì„ ì°¾ê¸° ìœ„í•´ HSV ìƒ‰ ê³µê°„ì„ í†µí•˜ì—¬ ì´ˆë¡ìƒ‰ì„ ì°¾ê³  ì´ì§„í™”ë¥¼ ì‹¤í–‰í•¨
 5. íšŒì „ì ì¸ ë¹¨ê°„ìƒ‰ê³¼ ì°©ì§€ì ì¸ íŒŒë€ìƒ‰ë„ ë™ì¼í•˜ê²Œ ì´ì§„í™”ë¥¼ ì‹¤í–‰í•¨
 6. [imfill](https://kr.mathworks.com/help/images/ref/imfill.html)ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì²« í–‰ê³¼ ë§ˆì§€ë§‰ í–‰ì„ 1ë¡œ ë°”ê¿ˆ
 7. imfillí•œ ì´ë¯¸ì§€ì™€ í•˜ì§€ ì•Šì€ ì´ë¯¸ì§€ë¥¼ ë¹„êµí•´ ë°”ë€ ë¶€ë¶„ì„ 1ìœ¼ë¡œ ë°”ë€Œì§€ ì•Šì€ ë¶€ë¶„ì„ 0ìœ¼ë¡œ í•˜ì—¬ ë§ ì¸ì‹

- **ë“œë¡  ì œì–´**

 8. ë§ì´ ì™¼ìª½ì— ìˆëŠ”ì§€ ì˜¤ë¥¸ìª½ì— ìˆëŠ”ì§€ íŒë‹¨í•˜ê¸° ìœ„í•´ ì˜ìƒì„ ë°˜ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ê°ê° í”½ì…€ ìˆ˜ë¥¼ ë”í•˜ì—¬ ì™¼ìª½ì´ ë§ìœ¼ë©´ ì™¼ìª½ìœ¼ë¡œ ROLL ì œì–´ ì´ë™í•˜ê³ , ì˜¤ë¥¸ìª½ì´ ë§ìœ¼ë©´ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ROLL ì œì–´ ì´ë™í•¨
ê·¸ë¦¬ê³  ì–‘ìª½ ê°’ì´ ê°™ë‹¤ê³  íŒë‹¨ë˜ë©´ THROTTLE ì œì–´ë¡œ ìœ„ë¡œ ì˜¬ë¼ê°€ ë§ êµ¬ë©ì„ ì°¾ìŒ
 9. ì´ë ‡ê²Œ ë§ ì„ ì°¾ì€ ë’¤ [regionprops](https://kr.mathworks.com/help/images/ref/regionprops.html)í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¤‘ì‹¬ì ì„ ì°¾ìŒ
 10. ìœ„ì—ì„œ ë°›ì€ Snapshot ì˜ìƒì˜ ì¤‘ì‹¬ì ê³¼ ë§ êµ¬ë© ì¤‘ì‹¬ì ì˜ ì°¨ì´ë¥¼ ê³„ì‚° í›„ **Xê°’ì˜ ì°¨ì´ê°€ 40ì´ë©´ ì¢Œìš°ë¡œ ë³´ì •**í•˜ê³ , **Yê°’ì˜ ì°¨ì´ê°€ 30ì´ë©´ ìƒí•˜ë¡œ ë³´ì •**í•œ ë’¤ **ì „ì§„** í•¨
 11. ë§ í†µê³¼ë¥¼ í•œ í›„ ë¹¨ê°„ìƒ‰ ì›ì„ ë°œê²¬í•˜ê²Œ ë˜ëŠ”ë°, ì´ ë•Œ í”½ì…€ ìˆ˜ë¥¼ í•©í•˜ì—¬ **400ì´ ë„˜ìœ¼ë©´ ì¢ŒíšŒì „**ì„ í•˜ê³ , **400ì´ ë„˜ì§€ ëª»í•˜ë©´ í›„ì§„**ì„ í•˜ì—¬ ë‹¤ì‹œ ì°¾ìŒ
 12. ë§ˆì§€ë§‰ìœ¼ë¡œ íŒŒë€ìƒ‰ ì›ì„ ë°œê²¬í•˜ê²Œ ë˜ë©´ ìœ„ì™€ ê°™ì´ **300ì´ ë„˜ìœ¼ë©´ ì°©ì§€**í•˜ê³ , ì•„ë‹ˆë©´ **í›„ì§„**í•˜ì—¬ ë‹¤ì‹œ ì°¾ìŒ

<br></br>
## 3. ì†ŒìŠ¤ì½”ë“œ ì„¤ëª…

- **ë“œë¡  ì„¤ì • ë° takeoff**
```matlab
clear;
drone=ryze(); 
cam=camera(drone);
originCenter=[480 200; 480 170; 480 170];
count=0;
max=0;
takeoff(drone);
preview(cam);
```
- **êµ¬ë© ì°¾ê¸°**
```matlab
%ì´ 3ë‹¨ê³„ë¡œ ì„¤ì •
for level=1:3
    %êµ¬ë© ì°¾ê¸°
    while 1
        %ì´ˆë¡ìƒ‰ì— ëŒ€í•œ HSVê°’ ì„¤ì • ë° ì´ì§„í™”
        frame=snapshot(cam);
        hsv = rgb2hsv(frame);
        h = hsv(:,:,1);
        s = hsv(:,:,2);
        v = hsv(:,:,3);
        green=(0.35<h)&(h<0.45)&(0.65<s)&(s<0.95);
        %ì²« í–‰ì„ 1ë¡œ ë³€í™˜
        for i=1:960
        green(1,i)=1;
        end
        %ë§ˆì§€ë§‰ í–‰ì„ 1ë¡œ 
        for i=1:960
        green(720,i)=1;
        end
        %êµ¬ë©ì„ ì±„ì›€
        bw2 = imfill(green,'holes');
        %êµ¬ë©ì„ ì±„ìš°ê¸° ì „ê³¼ í›„ë¥¼ ë¹„êµí•˜ì—¬ ê°’ì´ ì¼ì •í•˜ë©´ 0, ë³€í–ˆìœ¼ë©´ 1ë¡œ ë³€í™˜
        for x=1:720
            for y=1:960
                if green(x,y)==bw2(x,y)
                    bw2(x,y)=0;
                end
            end
        end
        %ë³€í™˜í•œ ì´ë¯¸ì§€ì˜ í”½ì…€ ìˆ˜ê°€ 1000ì´ìƒì´ë©´ êµ¬ë©ì„ ì¸ì‹í–ˆë‹¤ê³  íŒŒì•…
        %1000ì´í•˜ì´ë©´ ìƒìŠ¹í•˜ì—¬ ì „ ê³¼ì •ì„ ë‹¤ì‹œ ë°˜ë³µ
        if sum(bw2,'all')>1000
            break;
        else
            %í™”ë©´ì˜ ì¢Œìš°ë¥¼ ë¹„êµ
            if sum(imcrop(green,[0 0 480 720]),'all')-sum(imcrop(green,[480 0 960 720]),'all')>10000
                moveleft(drone,'distance',0.5,'speed',1);
            elseif sum(imcrop(green,[480 0 960 720]),'all')-sum(imcrop(green,[0 0 480 720]),'all')>10000
                moveright(drone,'distance',0.5,'speed',1);
            elseif sum(imcrop(green,[0 0 960 360]),'all')-sum(imcrop(green,[0 360 960 720]),'all')>10000
                moveup(drone,'distance',0.4,'speed',1);
            elseif sum(imcrop(green,[0 360 960 720]),'all')-sum(imcrop(green,[0 0 960 360]),'all')>10000
                movedown(drone,'distance',0.4,'speed',1);
            elseif sum(bw2,'all')<1000
                moveright(drone,'distance',0.5);
            end
        end
    end
```
- **êµ¬ë©ì— ëŒ€í•œ ì¤‘ì  ì°¾ê¸°**
```matlab
    %êµ¬ë©ì— ëŒ€í•œ ì¤‘ì  ì°¾ê¸°
    while 1
        %ì´ˆë¡ìƒ‰ì— ëŒ€í•œ HSVê°’ ì„¤ì • ë° ì´ì§„í™”
        frame=snapshot(cam);
        hsv = rgb2hsv(frame);
        h = hsv(:,:,1);
        s = hsv(:,:,2);
        v = hsv(:,:,3);
        green= (0.35<h)&(h<0.45)&(0.65<s)&(s<0.95);
        %ì²« í–‰ì„ 1ë¡œ ë³€í™˜
        for i=1:960
            green(1,i)=1;
        end
        %ë§ˆì§€ë§‰ í–‰ì„ 1ë¡œ ë³€í™˜
        for i=1:960
            green(720,i)=1;
        end
        %êµ¬ë©ì„ ì±„ì›€
        bw2 = imfill(green,'holes');
        %êµ¬ë©ì„ ì±„ìš°ê¸° ì „ê³¼ í›„ë¥¼ ë¹„êµí•˜ì—¬ ê°’ì´ ì¼ì •í•˜ë©´ 0, ë³€í–ˆìœ¼ë©´ 1ë¡œ ë³€í™˜
        for x=1:720
            for y=1:960
                if green(x,y)==bw2(x,y)
                    bw2(x,y)=0;
                end
            end
        end
        %ì´ë¯¸ì§€ì—ì„œ ì¸ì‹ëœ ê³³ë“¤ì˜ ì¤‘ì ê³¼ ë³´ì¡°ì¶•ì˜ í¬ê¸°ë¥¼ êµ¬í•¨
        stats = regionprops('table',bw2, 'Centroid', 'MinorAxisLength');
        z=stats.MinorAxisLength;
        max=0;
        y=stats.Centroid; %ì¤‘ì  ì°¾ì•„ì£¼ëŠ” ë³€ìˆ˜
        %ë³´ì¡°ì¶•ì˜ í¬ê¸°ê°€ ê°€ì¥ í° ê³³ì˜ ì¤‘ì ì„ ê°€ì ¸ì˜´
        for i=1:size(stats)
            if z(i,1)>=max
                max=z(i,1);
                firstCenter(1,1)=round(y(i,1));
                firstCenter(1,2)=round(y(i,2));
            end
        end
        disp(firstCenter); %firstCenter ì¶œë ¥
        clearvars max %maxë³€ìˆ˜ ì´ˆê¸°í™”
        %ì¸¡ì •ëœ ì¤‘ì ê³¼ ì´ìƒ ì¤‘ì ì„ ë¹„êµí•˜ì—¬ ì´ë™
        if firstCenter(1,1)-originCenter(level,1)>=40
            moveright(drone,'Distance',0.2,'speed',1);
            disp("right");
        elseif firstCenter(1,1)-originCenter(level,1)<=-40
            moveleft(drone,'Distance',0.2,'speed',1);
            disp("left");
        end
        if firstCenter(1,2)-originCenter(level,2)>=30
            movedown(drone,'Distance',0.3,'speed',1);
            disp("down");
        elseif firstCenter(1,2)-originCenter(level,2)<=-30
            moveup(drone,'Distance',0.2,'speed',1);
            disp("up");
        end
        %ì˜¤ì°¨ë²”ìœ„ ë‚´ì— ìˆìœ¼ë©´ ë°˜ë³µë¬¸ íƒˆì¶œ
        if firstCenter(1,2)-originCenter(level,2)<30 && firstCenter(1,2)-originCenter(level,2)>-30 && firstCenter(1,1)-originCenter(level,1)<40 && firstCenter(1,1)-originCenter(level,1)>-40
            break;
        end
    end
    %1ë‹¨ê³„ ë° 2ë‹¨ê³„ì¼ ë•Œ ì‹¤í–‰
    if level==1||level==2
        if level==1
            moveforward(drone,'Distance',2.6,'speed',1);
        elseif level==2
            moveforward(drone,'Distance',2.4,'speed',1);
        end
```
- **ë¹¨ê°„ì  ì¸ì‹**
```
        while 1
            %ë¹¨ê°„ìƒ‰ì— ëŒ€í•œ HSVê°’ ì„¤ì • ë° ì´ì§„í™”
            frame=snapshot(cam);
            hsv = rgb2hsv(frame);
            h = hsv(:,:,1);
            s = hsv(:,:,2);
            v = hsv(:,:,3);
            red= ((0.80<h)&(h<1)|(0<h)&(h<0.1))&(0.6<s)&(s<0.9)&(0.2<v)&(v<0.5);
            %ë¹¨ê°„ìƒ‰ì˜ í”½ì…€ì´ 400ì´ ë„˜ìœ¼ë©´ 90ë„ íšŒì „
            if sum(red,'all')>400
                if count==1
                    moveforward(drone,'distance',0.2);
                    count=0;
                end
                turn(drone,deg2rad(-90))
                break;
            else
                moveback(drone,'distance',0.2)
                count=1;
            end
        end
        %ê°€ìš´ë° ì•„ë˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ê¸°ìœ„í•œ ì œì–´
        if level==1
            moveforward(drone,'Distance',0.8,'speed',1);
        elseif level==2
            moveforward(drone,'distance',1,'speed',1);
            moveright(drone,'Distance',0.2,'speed',1);
        end
        %3ë‹¨ê³„ì¼ ë•Œ ì‹¤í–‰
    elseif level==3
        moveforward(drone,'Distance',2.1,'speed',1);
```
- **íŒŒë€ìƒ‰ ì  ì¸ì‹**
```
        while 1
            %íŒŒë€ìƒ‰ì— ëŒ€í•œ HSVê°’ ì„¤ì • ë° ì´ì§„í™”
            frame=snapshot(cam);
            hsv = rgb2hsv(frame);
            h = hsv(:,:,1);
            s = hsv(:,:,2);
            v = hsv(:,:,3);
            blue= (0.55<h)&(h<0.7)&(0.5<s)&(s<0.7)&(0.2<v)&(v<0.5);
            %íŒŒë€ìƒ‰ì˜ í”½ì…€ì´ 300ì´ ë„˜ìœ¼ë©´ 90ë„ íšŒì „
            if sum(blue,'all')>300
                if count==1
                    moveforward(drone,'distance',0.2);
                    count=0;
                end
                land(drone);
                break;
            else
                moveback(drone,'distance',0.2)
                count=1;
            end
        end
    end
end
```
